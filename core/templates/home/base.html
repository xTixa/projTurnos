<!DOCTYPE html>
<html lang="pt">

<head>
  {% load static %}
    <link rel="stylesheet" href="{% static 'css/base.css' %}?v={{ request.session.session_key|default:'10' }}">

  {% if request.user.is_authenticated and request.user.is_staff %}
    <link rel="stylesheet" href="{% static 'css/admin/admin.css' %}">
  {% endif %}

  {% block extra_css %}{% endblock %}

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Departamento de Informática{% endblock %}</title>

  <!-- Ícones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    referrerpolicy="no-referrer" />
</head>

<body>

  <!-- TOP NAVBAR -->
  <header class="topbar">
    <div class="topbar__left">

      <a class="logo" href="{% url 'home:index_di' %}">
        <i class="fa-solid fa-house"></i>
      </a>

      <nav class="toplinks">
        <a href="{% url 'home:index' %}" class="toplinks__link">
          <img src="{% static 'img/ei.png' %}" alt="EI" class="toplink-logo">
        </a>

        <a href="{% url 'home:index_tdm' %}" class="toplinks__link">
          <img src="{% static 'img/tdm.png' %}" alt="TDM" class="toplink-logo">
        </a>

        <a href="{% url 'home:index_mestrado' %}" class="toplinks__link">
          <img src="{% static 'img/eisi.png' %}" alt="EISI" class="toplink-logo">
        </a>

        <a href="{% url 'home:index_rsi' %}" class="toplinks__link">
          <img src="{% static 'img/rsi.png' %}" alt="RSI" class="toplink-logo">
        </a>

        <a href="{% url 'home:index_dwdm' %}" class="toplinks__link">
          <img src="{% static 'img/dwdm.png' %}" alt="DWDM" class="toplink-logo">
        </a>

        <a href="{% url 'home:index_di' %}" class="toplinks__link">
          <img src="{% static 'img/di.png' %}" alt="DI" class="toplink-logo">
        </a>
      </nav>

    </div>

    <div class="topbar__right">
      <a href="{% url 'home:index_forum' %}" class="toplinks__link">
        <img src="{% static 'img/forum.png' %}" alt="FórumAluno" class="toplink-logo">
      </a>

      {# ---------- ADMIN (Django User) ---------- #}
      {% if request.user.is_authenticated and request.user.is_staff %}

        <a href="{% url 'home:admin_dashboard' %}" class="btn btn-admin">
          <i class="fa-solid fa-screwdriver-wrench"></i>
          <span>Painel Admin</span>
        </a>

        <div class="user-dropdown">
          <button class="user-btn">
            <i class="fa-regular fa-user"></i>
            <span class="user-name">{{ request.user.username }}</span>
            <i class="fa-solid fa-chevron-down dropdown-icon"></i>
          </button>

          <div class="dropdown-menu hidden">
            <a href="{% url 'home:logout' %}" class="dropdown-item">
              <i class="fa-solid fa-right-from-bracket"></i> Terminar Sessão
            </a>
          </div>
        </div>

      {# ---------- ALUNO / DOCENTE ---------- #}
      {% elif request.session.user_id %}

        <div class="user-dropdown">
          <button class="user-btn">
            <i class="fa-regular fa-user"></i>
            <span class="user-name">{{ request.session.user_nome }}</span>
            <i class="fa-solid fa-chevron-down dropdown-icon"></i>
          </button>

          <div class="dropdown-menu hidden">
            <a href="{% url 'home:perfil' %}" class="dropdown-item">
              <i class="fa-regular fa-id-card"></i> Perfil
            </a>

            <a href="{% url 'home:logout' %}" class="dropdown-item">
              <i class="fa-solid fa-right-from-bracket"></i> Terminar Sessão
            </a>
          </div>
        </div>

      {# ---------- NÃO AUTENTICADO ---------- #}
      {% else %}

        <a href="{% url 'home:login' %}?next={{ request.get_full_path|urlencode }}" class="btn btn-ghost">
          <i class="fa-regular fa-user"></i>
          <span class="hide-sm">Login</span>
        </a>

      {% endif %}
    </div>

  </header>

  <!-- LAYOUT GERAL -->
  <div class="container-flex {% if request.user.is_authenticated and request.user.is_staff %}admin{% endif %}">

    {% block sidebar %}
    <aside class="sidebar">

      {% if request.user.is_authenticated and request.user.is_staff %}

        {% include "components/sidebar_admin.html" %}

        <hr>

        {% if area == "di" %}
          {% include "components/sidebar_di.html" %}
        {% elif area == "ei" %}
          {% include "components/sidebar_ei.html" %}
        {% elif area == "tdm" %}
          {% include "components/sidebar_tdm.html" %}
        {% elif area == "rsi" %}
          {% include "components/sidebar_rsi.html" %}
        {% elif area == "eisi" %}
          {% include "components/sidebar_mestrado.html" %}
        {% elif area == "dwdm" %}
          {% include "components/sidebar_dwdm.html" %}
        {% endif %}

      {% else %}

        {% if area == "di" %}
          {% include "components/sidebar_di.html" %}
        {% elif area == "ei" %}
          {% include "components/sidebar_ei.html" %}
        {% elif area == "tdm" %}
          {% include "components/sidebar_tdm.html" %}
        {% elif area == "rsi" %}
          {% include "components/sidebar_rsi.html" %}
        {% elif area == "eisi" %}
          {% include "components/sidebar_mestrado.html" %}
        {% elif area == "dwdm" %}
          {% include "components/sidebar_dwdm.html" %}
        {% endif %}

      {% endif %}

    </aside>
    {% endblock %}

    <main class="main-content">
      {% block content %}{% endblock %}
    </main>

  </div>

  {% block extra_scripts %}
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.querySelector(".user-btn");
      const menu = document.querySelector(".dropdown-menu");
      const icon = document.querySelector(".dropdown-icon");

      if (btn) {
        btn.addEventListener("click", () => {
          menu.classList.toggle("hidden");
          icon.style.transform = menu.classList.contains("hidden") ? "rotate(0deg)" : "rotate(180deg)";
        });

        document.addEventListener("click", (e) => {
          if (!btn.contains(e.target) && !menu.contains(e.target)) {
            menu.classList.add("hidden");
            icon.style.transform = "rotate(0deg)";
          }
        });
      }
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const buttons = document.querySelectorAll(".submenu-btn");
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          btn.parentElement.classList.toggle("open");
        });
      });
    });
  </script>
  {% endblock %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>
