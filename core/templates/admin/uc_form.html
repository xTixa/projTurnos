{% extends "../home/base.html" %}

{% block content %}
<h1>
	<i class="fa-solid fa-book"></i>
	{% if uc %}Editar UC — {{ uc.nome }}{% else %}Nova Unidade Curricular{% endif %}
</h1>

{% if uc %}
	<p class="text-muted">
		<strong>ID:</strong> {{ uc.id_unidadecurricular }} · 
		<strong>ECTS:</strong> {{ uc.ects }} · 
		<strong>Ano:</strong> {{ uc.id_anocurricular.ano_curricular }} · 
		<strong>Semestre:</strong> {{ uc.id_semestre.semestre }}º · 
		<strong>Curso:</strong> {{ uc.id_curso.nome }}
	</p>
{% endif %}

<form method="post">
	{% csrf_token %}
	<input type="hidden" name="action" value="update_uc">

	<label for="nome">Nome</label>
	<input type="text" id="nome" name="nome" value="{% if uc %}{{ uc.nome }}{% endif %}" required>

	<label for="ects">ECTS</label>
	<input type="number" step="0.5" min="0" id="ects" name="ects" value="{% if uc %}{{ uc.ects|stringformat:"g" }}{% endif %}" required>

	<label for="curso">Curso</label>
	<select name="curso" id="curso" required>
		<option value="">Selecionar Curso</option>
		{% for c in cursos %}
		<option value="{{ c.id_curso }}" {% if uc and uc.id_curso.id_curso == c.id_curso %}selected{% endif %}>{{ c.nome }}</option>
		{% endfor %}
	</select>

	<label for="ano">Ano Curricular</label>
	<select name="ano" id="ano" required>
		<option value="">Selecionar Ano</option>
		{% for a in anos %}
		<option value="{{ a.id_anocurricular }}" {% if uc and uc.id_anocurricular.id_anocurricular == a.id_anocurricular %}selected{% endif %}>{{ a.ano_curricular }}</option>
		{% endfor %}
	</select>

	<label for="semestre">Semestre</label>
	<select name="semestre" id="semestre" required>
		<option value="">Selecionar Semestre</option>
		{% for s in semestres %}
		<option value="{{ s.id_semestre }}" {% if uc and uc.id_semestre.id_semestre == s.id_semestre %}selected{% endif %}>{{ s.semestre }}º Semestre</option>
		{% endfor %}
	</select>

	<div style="margin-top: 20px;">
		<button type="submit" class="btn btn-primary">
			<i class="fa-solid fa-save"></i> Guardar
		</button>
		<a href="{% url 'home:admin_uc_list' %}" class="btn btn-secondary">
			<i class="fa-solid fa-arrow-left"></i> Voltar
		</a>
	</div>
</form>

{% if uc %}
<hr>
<h2>Turnos desta UC</h2>
{% if turnos_uc and turnos_uc|length > 0 %}
<table border="1" cellpadding="6" style="margin-bottom: 1em;">
	<tr>
		<th>Nº Turno</th>
		<th>Tipo</th>
		<th>Capacidade</th>
		<th>Hora Início</th>
		<th>Hora Fim</th>
		<th>Ações</th>
	</tr>
	{% for t in turnos_uc %}
	<tr>
		<td>{{ t.id_turno.n_turno }}</td>
		<td>{{ t.id_turno.tipo }}</td>
		<td>{{ t.id_turno.capacidade }}</td>
		<td>{{ t.hora_inicio|default_if_none:"" }}</td>
		<td>{{ t.hora_fim|default_if_none:"" }}</td>
		<td>
			<form method="post" style="display:inline;">
				{% csrf_token %}
				<input type="hidden" name="action" value="delete_turno">
				<input type="hidden" name="turno_id" value="{{ t.id_turno.id_turno }}">
				<button type="submit" onclick="return confirm('Remover este turno?');">Remover</button>
			</form>
		</td>
	</tr>
	{% endfor %}
</table>
{% else %}
<p>Não existem turnos associados a esta UC.</p>
{% endif %}

<h3>Adicionar novo turno</h3>
<form method="post">
	{% csrf_token %}
	<input type="hidden" name="action" value="add_turno">
	<label for="n_turno">Nº Turno</label>
	<input type="text" name="n_turno" id="n_turno" required>
	<label for="tipo">Tipo</label>
	<select name="tipo" id="tipo" required>
		<option value="">Selecionar tipo</option>
		<option value="T">Teórico</option>
		<option value="TP">Teórico-Prático</option>
		<option value="PL">Laboratório</option>
	</select>
	<label for="capacidade">Capacidade</label>
	<input type="number" name="capacidade" id="capacidade" min="1" required>
	<label for="hora_inicio">Hora Início</label>
	<input type="time" name="hora_inicio" id="hora_inicio" required>
	<label for="hora_fim">Hora Fim</label>
	<input type="time" name="hora_fim" id="hora_fim" required>
	<button type="submit">Adicionar Turno</button>
</form>
{% endif %}
{% endblock %}
