{% extends "../home/base.html" %}
{% load static %}

{% block title %}Gestão de Propostas DAPE — Admin Panel{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin/users_form.css' %}">
<link rel="stylesheet" href="{% static 'css/admin/dape.css' %}">
{% endblock %}

{% block content %}

<div class="users-container dape-list">
    <h1 class="page-title"><i class="fa-solid fa-briefcase"></i> Gestão de Propostas DAPE</h1>

    <div class="quick-actions">
        <a href="{% url 'home:admin_dape_create' %}">
            <i class="fa-solid fa-plus"></i> Nova Proposta
        </a>
    </div>

    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- LISTA DE PROPOSTAS -->
    <div class="list-section">
        <h2>Lista de Propostas</h2>

        {% if propostas %}
            <div class="table-info">Total: <strong>{{ total_propostas }}</strong> proposta(s)</div>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Título</th>
                        <th>Entidade</th>
                        <th>Modelo</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>

                <tbody>
                    {% for proposta in propostas %}
                    <tr>
                        <td><strong>#{{ proposta.id_proposta }}</strong></td>
                        <td>{{ proposta.titulo }}</td>
                        <td>{{ proposta.entidade }}</td>
                        <td>
                            {% if proposta.modelo %}
                                <span class="badge badge-modelo-{{ proposta.modelo|lower }}">{{ proposta.modelo }}</span>
                            {% else %}
                                <span style="color: #999;">—</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if proposta.aluno_atribuido %}
                                <span class="status-inactive" title="Atribuída a: {{ proposta.aluno_atribuido.nome }}">
                                    <i class="fa-solid fa-user-check"></i> Atribuída
                                </span>
                            {% else %}
                                <span class="status-active">
                                    <i class="fa-solid fa-check"></i> Disponível
                                </span>
                            {% endif %}
                        </td>
                        <td class="actions-cell">
                                     <a href="{% url 'home:proposta_detalhes' proposta.proposta_id %}" 
                                         class="btn-view" 
                               title="Ver detalhes"
                               target="_blank"
                                         >
                                <i class="fa-solid fa-eye"></i> Ver
                            </a>
                            <a href="{% url 'home:admin_dape_edit' proposta.id_proposta %}" 
                               class="btn-edit" 
                               title="Editar proposta">
                                <i class="fa-regular fa-pen-to-square"></i> Editar
                            </a>
                            <a href="{% url 'home:admin_dape_delete' proposta.id_proposta %}" 
                               class="btn-delete" 
                               title="Eliminar proposta"
                               onclick="return confirm('Tem certeza que deseja eliminar a proposta \'{{ proposta.titulo }}\'?');">
                                <i class="fa-solid fa-trash"></i> Apagar
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-data">
                <i class="fa-solid fa-briefcase" style="font-size: 2rem; margin-bottom: 10px; display: block; color: #ccc;"></i>
                Nenhuma proposta registada.<br>
                <a href="{% url 'home:admin_dape_create' %}" class="btn-create" style="margin-top: 15px;">+ Criar Primeira Proposta</a>
            </p>
        {% endif %}
    </div>
</div>

{% endblock %}
