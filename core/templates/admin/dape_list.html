{% extends "../home/base.html" %}
{% load static %}

{% block title %}Gestão de Propostas DAPE — Admin Panel{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/admin/users_form.css' %}">

<div class="users-container">
    <h1><i class="fa-solid fa-briefcase"></i> Gestão de Propostas DAPE</h1>

    <!-- Botão para criar nova proposta -->
    <div class="action-buttons">
        <a href="{% url 'home:admin_dape_create' %}" class="btn-create">+ Nova Proposta</a>
        <a href="{% url 'home:admin_dashboard' %}" class="btn-filter-reset" style="margin-left: 10px;">
            <i class="fa-solid fa-arrow-left"></i> Voltar ao Dashboard
        </a>
    </div>

    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- LISTA DE PROPOSTAS -->
    <div class="list-section">
        <h2>Lista de Propostas</h2>

        {% if propostas %}
            <div class="table-info">Total: <strong>{{ total_propostas }}</strong> proposta(s)</div>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Título</th>
                        <th>Entidade</th>
                        <th>Modelo</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>

                <tbody>
                    {% for proposta in propostas %}
                    <tr>
                        <td><strong>#{{ proposta.id_proposta }}</strong></td>
                        <td>{{ proposta.titulo }}</td>
                        <td>{{ proposta.entidade }}</td>
                        <td>
                            {% if proposta.modelo %}
                                <span class="badge badge-modelo-{{ proposta.modelo|lower }}">{{ proposta.modelo }}</span>
                            {% else %}
                                <span style="color: #999;">—</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if proposta.aluno_atribuido %}
                                <span class="status-inactive" title="Atribuída a: {{ proposta.aluno_atribuido.nome }}">
                                    <i class="fa-solid fa-user-check"></i> Atribuída
                                </span>
                            {% else %}
                                <span class="status-active">
                                    <i class="fa-solid fa-check"></i> Disponível
                                </span>
                            {% endif %}
                        </td>
                        <td class="actions-cell">
                            <a href="{% url 'home:proposta_detalhes' proposta.proposta_id %}" 
                               class="btn-edit" 
                               title="Ver detalhes"
                               target="_blank"
                               style="background-color: #17a2b8;">
                                <i class="fa-solid fa-eye"></i> Ver
                            </a>
                            <a href="{% url 'home:admin_dape_edit' proposta.id_proposta %}" 
                               class="btn-edit" 
                               title="Editar proposta">
                                <i class="fa-regular fa-pen-to-square"></i> Editar
                            </a>
                            <a href="{% url 'home:admin_dape_delete' proposta.id_proposta %}" 
                               class="btn-delete" 
                               title="Eliminar proposta"
                               onclick="return confirm('Tem certeza que deseja eliminar a proposta \'{{ proposta.titulo }}\'?');">
                                <i class="fa-solid fa-trash"></i> Apagar
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-data">
                <i class="fa-solid fa-briefcase" style="font-size: 2rem; margin-bottom: 10px; display: block; color: #ccc;"></i>
                Nenhuma proposta registada.<br>
                <a href="{% url 'home:admin_dape_create' %}" class="btn-create" style="margin-top: 15px;">+ Criar Primeira Proposta</a>
            </p>
        {% endif %}
    </div>
</div>

<style>
    /* Tabela DAPE - larguras das colunas */
    .admin-table th:nth-child(1),
    .admin-table td:nth-child(1) { width: 60px; } /* ID */
    .admin-table th:nth-child(2),
    .admin-table td:nth-child(2) { width: 30%; max-width: 250px; } /* Título */
    .admin-table th:nth-child(3),
    .admin-table td:nth-child(3) { width: 20%; max-width: 180px; } /* Entidade */
    .admin-table th:nth-child(4),
    .admin-table td:nth-child(4) { width: 100px; } /* Modelo */
    .admin-table th:nth-child(5),
    .admin-table td:nth-child(5) { width: 100px; } /* Status */
    
    .admin-table td:nth-child(2),
    .admin-table td:nth-child(3) {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    /* Badges para modelos */
    .badge-modelo-presencial {
        background-color: #d4edda;
        color: #155724;
    }
    .badge-modelo-remoto {
        background-color: #cce5ff;
        color: #004085;
    }
    .badge-modelo-híbrido, .badge-modelo-hibrido {
        background-color: #fff3cd;
        color: #856404;
    }
    
    /* Alerts */
    .messages-container {
        margin-bottom: 20px;
    }
    .alert {
        padding: 12px 15px;
        border-radius: 4px;
        margin-bottom: 10px;
        font-size: 14px;
    }
    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
</style>

{% endblock %}
