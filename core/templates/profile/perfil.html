{% extends "home/base.html" %}
{% load static %}

{% block sidebar %}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/perfil.css' %}?v=6">

<div class="layout-container">

  {# ---------- 1. HERO PROFILE SECTION ---------- #}
  {% if user_obj or user.is_authenticated %}
  <section class="profile-hero">
      <div class="hero-banner"></div>

      <div class="hero-content">
          <div class="avatar-wrapper">
             <div class="avatar-inner">
                 {% if tipo == "Aluno" %}
                   <i class="fa-regular fa-user"></i>
                 {% else %}
                   <i class="fa-solid fa-user-shield"></i>
                 {% endif %}
             </div>
          </div>
          
          <div class="profile-info-block">
            {% if user_obj %}
                <h1 class="profile-user-name">{{ user_obj.nome }}</h1>
                <div class="profile-user-meta">
                   <div class="profile-meta-item"><i class="fa-regular fa-envelope"></i> {{ user_obj.email }}</div>
                   {% if tipo == "Aluno" %}
                     <div class="profile-meta-item"><i class="fa-solid fa-id-card"></i> {{ user_obj.n_mecanografico }}</div>
                   {% endif %}
                </div>
            {% elif user.is_authenticated %}
                <h1 class="profile-user-name">{{ user.username }}</h1>
                <div class="profile-user-meta">
                   <div class="profile-meta-item"><i class="fa-regular fa-envelope"></i> {{ user.email|default:"S/ Email" }}</div>
                   <div class="profile-meta-item"><span style="background:#dcfce7; color:#166534; padding:2px 8px; border-radius:10px; font-size:0.8em; font-weight:700">ADMIN</span></div>
                </div>
            {% endif %}
          </div>

          <div class="profile-user-stats">
             {% if tipo == "Aluno" %}
             <div class="profile-stat-box">
                <span class="profile-stat-value">{{ turnos|length }}</span>
                <span class="profile-stat-label">Inscrições</span>
             </div>
             {% endif %}
          </div>
      </div>
  </section>

  {# ---------- 2. GRID SECTIONS ---------- #}
  
  {% if tipo == "Aluno" %}
      <h3 class="page-subtitle">
        Os Meus Turnos
      </h3>

      {% if turnos %}
        <div class="grid-cards">
          {% for t in turnos %}
          <div class="shift-card">
            <div class="shift-top">
               <div class="uc-badge">
                 <i class="fa-solid fa-book-bookmark"></i>
               </div>
               <span class="shift-tag">{{ t.tipo }}</span>
            </div>
            
            <div class="shift-title">{{ t.uc }}</div>
            
            <div class="shift-details">
               <i class="fa-regular fa-clock"></i>
               <span>{{ t.horario }}</span>
               <div style="margin-left:auto; font-weight:700; color:var(--primary)">
                 {{ t.turno }}
               </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-box">
           <i class="fa-regular fa-calendar-xmark" style="font-size:3rem; color: #cbd5e1; margin-bottom:1rem"></i>
           <p style="color:#64748b; margin-bottom:1.5rem">Ainda não te inscreveste em nenhum turno.</p>
           <a href="{% url 'home:inscricao_turno' %}" class="action-btn">Inscrever Agora</a>
        </div>
      {% endif %}

  {% elif user.is_authenticated %}
     <h3 class="page-subtitle">Área de Administração</h3>
     <div class="grid-cards">
         <div class="shift-card" onclick="location.href='{% url 'home:admin_dashboard' %}'" style="cursor: pointer;">
             <div class="shift-top">
                 <div class="uc-badge" style="background:#f59e0b; color:white">
                     <i class="fa-solid fa-gauge-high"></i>
                 </div>
             </div>
             <div class="shift-title">Painel de Controlo</div>
             <div class="shift-details">
                 Aceder à gestão integral do sistema.
             </div>
         </div>
     </div>
  {% endif %}

  {% else %}
    <div style="text-align:center; padding: 4rem;">
       <h2>Sem Sessão Iniciada</h2>
       <p style="color:#64748b; margin-bottom:2rem">Precisas de entrar na tua conta para ver o teu perfil.</p>
       <a href="{% url 'home:login' %}" style="background:var(--primary); color:white; padding:12px 24px; border-radius:8px; text-decoration:none; font-weight:600">
         Ir para Login
       </a>
    </div>
  {% endif %}
  
</div>
{% endblock %}
